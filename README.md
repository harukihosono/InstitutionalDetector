# Institutional Detector（機関投資家検出インジケーター）

MT4/MT5対応の大口注文検出インジケーターです。ボリュームのZスコア分析により、機関投資家の可能性がある大口注文パターンをリアルタイムで検出します。

## 機能

### 検出タイプ

| タイプ | 説明 | 特徴 |
|--------|------|------|
| **アグレッシブ注文** | 価格変動を伴う大きなボリューム | 市場に大きなインパクトを与える注文 |
| **吸収注文** | 価格変動を抑える大きなボリューム | 売り圧力を吸収する受動的な注文 |
| **アイスバーグ注文** | 連続する大きなボリュームのパターン | 大口注文を分割して執行する隠密注文 |

### 表示内容

- **サブウィンドウ**: ボリュームヒストグラム、Zスコアライン、検出シグナル
- **メインチャート**: 検出位置に縦線表示（緑=買い、赤=売り）
- **GUIパネル**: 閾値調整、検出タイプ切替、統計情報

## インストール

### MT4の場合
1. `InstitutionalDetector.mq4` と全ての `.mqh` ファイルを以下にコピー：
   ```
   [MT4データフォルダ]/MQL4/Indicators/InstitutionalDetector/
   ```
2. MT4を再起動、またはナビゲーターで「更新」
3. コンパイル（F7キー）

### MT5の場合
1. `InstitutionalDetector.mq5` と全ての `.mqh` ファイルを以下にコピー：
   ```
   [MT5データフォルダ]/MQL5/Indicators/InstitutionalDetector/
   ```
2. MT5を再起動、またはナビゲーターで「更新」
3. コンパイル（F7キー）

### 必要ファイル
```
InstitutionalDetector/
├── InstitutionalDetector.mq4  # MT4メインファイル
├── InstitutionalDetector.mq5  # MT5メインファイル
├── ID_Defines.mqh             # 定数・マクロ定義
├── ID_Inputs.mqh              # 入力パラメータ
├── ID_Globals.mqh             # グローバル変数
├── ID_Utils.mqh               # ユーティリティ関数
├── ID_GUI.mqh                 # GUI関連
└── ID_Detection.mqh           # 検出ロジック
```

## 使い方

### 基本操作

1. チャートにインジケーターをドラッグ＆ドロップ
2. サブウィンドウにZスコアが表示される
3. 閾値を超えると検出シグナルが発生
4. メインチャートに縦線が描画される

### GUI操作

| コントロール | 説明 |
|-------------|------|
| 閾値入力欄 | 検出閾値を直接入力（推奨：1.5〜3.0） |
| ▲/▼ボタン | 閾値を0.1ずつ増減 |
| 適用ボタン | 入力した閾値を適用 |
| リセットボタン | 全設定をデフォルトに戻す |
| チェックボックス | 各検出タイプのON/OFF切替 |

### 閾値ラインのドラッグ

サブウィンドウの黄色い水平線をドラッグして閾値を直接調整できます。

## パラメータ設定

| パラメータ | デフォルト | 説明 |
|-----------|-----------|------|
| Lookback Period | 20 | Zスコア計算の参照期間 |
| Volume Threshold | 2.0 | 検出閾値（標準偏差の倍率） |
| Price Change Threshold | 0.001 | 価格変動判定の閾値（0.1%） |
| Detect Aggressive | true | アグレッシブ注文の検出 |
| Detect Absorption | true | 吸収注文の検出 |
| Detect Iceberg | true | アイスバーグ注文の検出 |
| Show Alerts | true | アラートダイアログ表示 |
| Send Notification | false | プッシュ通知送信 |
| Play Sound | true | サウンド再生 |

## 閾値の目安

| 閾値 | 感度 | 用途 |
|-----|------|------|
| 1.5 | 高 | 短期トレード、多くのシグナルを確認したい場合 |
| 2.0 | 中 | 標準的な使用（デフォルト） |
| 2.5 | 低 | より確度の高いシグナルのみ |
| 3.0+ | 極低 | 大きなイベントのみ検出 |

## 検出ロジック

### Zスコア計算
```
Z-Score = (現在のボリューム - 移動平均) / 標準偏差
```

### 検出条件

**アグレッシブ注文**
- Zスコア > 閾値
- 価格変動 > Price Change Threshold × 3

**吸収注文**
- Zスコア > 閾値
- 価格変動 < Price Change Threshold
- 次の足の方向で売買判定

**アイスバーグ注文**
- 直近3本のZスコアが全て1.0以上
- 終値位置で売買判定

## 注意事項

- 本インジケーターは分析ツールであり、売買シグナルではありません
- ボリュームデータはFXではティックボリュームを使用します
- 他のテクニカル分析と組み合わせて使用することを推奨します
- 過去の検出結果が将来の結果を保証するものではありません

## 動作環境

- MetaTrader 4 Build 1000以上
- MetaTrader 5 Build 2000以上

## バージョン履歴

### v1.11
- パフォーマンス最適化
- モジュール分割による保守性向上
- 表示同期の改善
- GUI即時更新機能追加

### v1.10
- 初回リリース
- 3種類の検出タイプ実装
- GUIパネル実装

## ライセンス

本ソフトウェアはMITライセンスの下で配布されます。

---

**免責事項**: 本インジケーターの使用による損失について、作者は一切の責任を負いません。投資判断は自己責任で行ってください。
